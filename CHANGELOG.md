# Changelog

All notable changes to 写稿Agent will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [0.6.2] - 2026-02-21

### Changed
- 🔧 **工作流收尾机制增强 (Stage 12)**：新增全局必定触发的终极收尾步骤。无论在 Stage 9、10 还是 11 结束，工作流导演都必须自动生成一份无多余空行、无 Markdown 标记的 `[文章名]_clean.txt` 排版纯净版，方便直接复制到微信公众号等编辑器格式化发布。
- 🔧 **交互引导优化**：在 `toutiao-reader-test` (Stage 9) 结束后注入防漏网的新手引导选项面板，强制输出 Stage 10/11 进阶阶段的功能介绍，去除了容易引发"代理提前完结幻觉"的措辞。
- 🗑️ **冗余逻辑清理**：移除原本存在于 `humanizer` (去AI味专家) 子代理中重复的纯净版 txt 导出逻辑，已将其架构升级封装进全局收尾流程（Stage 12）中。

### Fixed
- 🐛 修复 `workflow-producer` (工作流导演) 经常在 Stage 9 结束时因为看到"测试通过"等字眼，擅自输出大结局回顾导致后续深加工阶段无法向用户展示的缺陷。新增"严禁早退"核心禁令。

## [0.6.1] - 2026-02-10

### 🎨 新增：文章配图 Agent (Article Illustrator)

新增独立的 `article-illustrator` 子代理，专注于为文章设计视觉风格并生成高质量配图。

- **核心功能**：
  - **双维度设计**：基于 Type (类型) × Style (风格) 理论，设计封面、插图、概念图。
  - **策划-执行模式**：Agent 先输出配图策划案，经用户确认后，再批量调用脚本生成，确保可控性。
  - **自动化插图**：生成的图片会自动插入到 Markdown 文档的对应位置。
  - **多模型支持**：支持 Google Gemini 官方 API 和第三方 OpenAI 兼容接口 (如 GPTGod)，配置灵活。

### Added
- ✨ **Humanizer 去AI味专家**：基于 Wikipedia AI Cleanup 项目，深度去除 AI 痕迹，注入人类观点与细节。
- ✨ **读者模拟器 v3.0 直播版**：升级为"直播"模式，模拟读者的心理弹幕、真话吐槽和朋友圈分享预览。

### Changed
- 🔧 **工作流升级**：新增 **Stage 10 (去AI味)** 和 **Stage 11 (配图/视觉增强)**，完善了文章发布前的最后两公里。新增 **Stage 12 (导出纯净版)**，作为流程大结局的防漏网标配。
- 🔧 **交互协议强化**：Article Illustrator 现在强制执行"策划-确认-执行"三步走，严禁自动生成，确保用户有修改配图方案的机会。

### Fixed
- 🐛 修复工作流在 Stage 9 (读者测试) 结束后可能意外终止的问题，强化了进入 Stage 10 的指令。
- 🐛 修复配图代理可能会跳过用户确认直接生成图片的问题。

## [0.5.1] - 2026-01-28

### 🎯 增强审稿质量：具体修改建议 + 用户确认

解决"打分就过"的问题，所有评审环节必须给出可执行的修改方案，并等待用户确认。

### Changed
- 🔧 **title-designer v2.0** - 标题设计师升级：
  - 新增：15种爆款标题公式（分6大类：冲突、悬念、身份、数字、情绪、场景）
  - 新增：从3个候选增加到5个候选
  - 新增：每个标题需说明"钩子"和"预估点击人群"
  - 新增：6项自检清单 + 推荐排序
  - 新增：用户可请求修改/换公式

- 🔧 **pre-publish-review v2.0** - 发布前评审升级：
  - 新增：每个低分项必须给出具体修改方案（原文→改为）
  - 新增：红队问题必须给出可执行的修改建议
  - 新增：修改建议分三级（必须/建议/可选）
  - 新增：用户确认环节（A/B/C/D/E选择）
  - 新增：可自动执行修改并保存新版本

- 🔧 **toutiao-reader-test v2.1** - 读者模拟升级：
  - 新增：每个问题必须给出"原文→改为"的具体修改方案
  - 新增：用户确认环节（A/B/C/D/E/F选择）
  - 新增：可自动执行修改并保存新版本
  - 新增：修改后可选择重新测试
  - 修复：不能只打分就结束，必须等用户确认

### Fixed
- 🐛 标题设计太平淡 - 增加15种爆款公式和具体钩子说明
- 🐛 读者模拟只打分不给建议 - 必须给出可执行的修改方案
- 🐛 评审环节不等用户确认 - 强制等待用户选择

---

## [0.5.0] - 2026-01-25

### 🚀 重大架构升级：Skills + Subagents 混合模式

本版本引入 **Subagent 架构**，实现上下文隔离，解决 Token 累积问题。

### Added
- 🔄 **12 个独立 Subagent**（位于 `.claude/agents/`）：
  - `topic-generator` - 选题生成器
  - `topic-research` - 选题调研
  - `writing-clarifier` - 澄清需求
  - `research-expert` - 调研素材
  - `outline-architect` - 大纲设计
  - `empathy-designer` - 共情点设计
  - `concretizer` - 具象化专家
  - `title-designer` - 标题设计师
  - `writing-executor` - 写作执行
  - `editor-review` - 主编审稿
  - `pre-publish-review` - 发布前评审
  - `toutiao-reader-test` - 今日头条读者模拟

- 🎯 **Subagent 调用语法**：
  ```
  使用 [subagent-name] 子代理来 [任务描述]。
  项目名称：[项目名]
  ```

### Changed
- 🔧 **工作流导演升级 v3.0**：
  - 改用显式调用 Subagent 的方式（原来是语义触发 Skill）
  - 强化第一条规则：必须先询问模式（A/B/C）
  - 每个阶段通过文件传递信息，不依赖对话上下文

- 🔧 **CLAUDE.MD 更新**：
  - 完整更新为 Subagent 架构说明
  - 明确 Subagent 调用语法
  - 列出所有可用 Subagent

- 🔧 **Skills 精简**：
  - 保留 3 个核心 Skill：工作流导演、公众号文章获取、风格建模
  - 删除 12 个旧 Skill（已迁移为 Subagent）

### Benefits
- ✅ **上下文隔离**：每个 Subagent 独立执行，不累积 Token
- ✅ **文件传递**：信息通过 `articles/[项目名]/` 目录下的文件传递
- ✅ **断点续写**：每阶段产物自动落盘，支持中断后继续
- ✅ **灵活调度**：工作流导演可根据需要跳过/重复某些步骤

## [0.4.0] - 2026-01-19

### Added
- 🎯 **今日头条读者模拟器 v1.0**（新增 Skill）：
  - **定位**：最后的守门员，在所有评审通过后，模拟刷今日头条的普通人测试文章。
  - **四道关卡**：3秒标题测试（会不会点开）、10秒开头测试（会不会继续）、3分钟中间测试（会不会跳出）、5秒分享测试（会不会分享）。
  - **读者画像**：张三，32岁，普通上班族，地铁上刷手机，只关心吸引力和分享价值。
  - **逐段反应**：用emoji标记每段反应（😊有意思/😐还行/😴想跳过/👍想点赞），用第一人称写"内心OS"。
  - **下一步建议**：提供4个选项（快速修改再测/回到主编审稿/回到发布前评审/直接发布），根据问题数量给出推荐。
  - **效果**：从用户体验角度检验文章，确保真正能吸引普通读者。

### Changed
- 🔧 **主编审稿升级 v2.2**：
  - **新增平淡度检测**：检测文章缺少情绪、金句、画面感等传播力问题。
  - **5个检测维度**：情绪爆发点（感叹号/脏话/短句）、金句密度（可截图分享）、案例画面感（对话/动作/场景）、过渡词温和度（说理型vs口语型）、结尾检测（思考题）。
  - **新增假名人案例检测**：检测AI典型的"陌生人名+年龄+职业"案例模式（如"薛冰雷，35岁，部门经理..."），建议改为"我朋友"、"老王"等。
  - **详细改写示例**：每个问题都提供具体的改写示例。

- 🔧 **发布前评审升级 v2.2**：
  - **红队评审新增第6项**：段落间重复检查（相同句式/结论/数据推论重复）。
  - **红队评审新增第7项**：传播力缺失检查（缺少情绪/金句/画面感）。
  - **假名人案例检查**：在"AI味道残留"中增加假名人案例检测。
  - **扣分规则更新**：全文无金句(-2分)、情绪过于平淡(-1分)、段落间明显重复(-2分)。
  - **红队结论更新**：7项中有5项以上无问题 → 通过。

### Fixed
- 🐛 修复发布前评审容易给虚高评分的问题（通过红队评审机制）
- 🐛 修复主编审稿未检测到段落间重复的问题
- 🐛 修复评审未检测到假名人案例的问题
- 🐛 修复评审未检测到文章平淡（缺少传播力）的问题

## [0.3.3] - 2026-01-16

### Changed
- 🔧 **发布前评审升级 v2.0**：
  - **红队评审机制**：新增强制挑刺环节，即使文章很好也必须找出5个潜在问题（标题致命伤/开头劝退点/AI味道/逻辑漏洞/情绪过载）。
  - **硬性指标检查**：标题问增加4项可验证指标，不符合2项以上自动扣1星。
  - **红队扣分机制**：AI套路结尾(-2分)、缺少出路(-2分)、粗俗表达(-1分)、逻辑严重漏洞(-2分)。
  - **最终评分优化**：常规评分 + 红队扣分 = 最终得分，防止虚高评分。
  - **效果**：解决了原评审机制容易给满分的问题，评分更客观真实。

## [0.3.2] - 2026-01-16

### Added
- 🚀 **选题生成器 (topic-generator)**：
  - **从0到1生成选题**：当用户不知道写什么时，AI 智能推荐候选选题。
  - **三层架构**：
    - 灵感触发：热点扫描、个人资产盘点、竞品分析三维度生成 8-10 个候选。
    - 选题验证：五问评分机制（痛点真实性/竞争度/个人优势/传播潜力/可持续性）。
    - 选题具象化：拆解子话题、设计开头钩子、生成素材清单。
  - **选题库管理**：新增 `articles/_topic_pool/` 目录，支持保存、回顾、重新验证选题。
  - **数据驱动**：所有推荐基于真实搜索数据，避免"自嗨式选题"。

## [0.3.1] - 2026-01-06

### Added
- 🚀 **风格建模闭环工作流**：
  - **URL 一键提取**：`style-modeler` 现在直接支持 URL 输入，自动调用 `web-article-extractor` 抓取正文。
  - **公众号自动处理**：针对微信公众号链接，自动应用绕过安全限制的配置。
  - **批量串行提取**：支持一次性投喂多篇 URL，自动构建“超级样本”进行整体分析。
  - **增量更新机制**：自动识别同作者，支持将新文章融合到现有风格文件中，迭代进化。
  - **自动归档**：提取的原始文章会自动保存为 Markdown 到 `docs/` 目录，建立本地素材库。
## [0.3.0] - 2026-01-04

### Added
- 🚀 **爆款能力全面升级**：
  - **核心思路转变**：从"写得好"（文笔流畅）转向"写对了"（读者痛点/爆款传播）。
  - **选题调研 Skill**（`topic-research`）：
    - 写作前的第一步，防止自嗨。
    - 4步调研法：热点扫描 → 爆款拆解 → 痛点验证 → 选题打分。
  - **发布前评审 Skill**（`pre-publish-review`）：
    - 写作后的最后一步，质量最后一道防线。
    - "发布前5问"清单：标题、开头、认同、出路、转发价值。
    - 评分低于一定标准强烈建议重写。

- ⚡ **核心 Skill 增强**：
  - **标题设计师**（`title-designer`）：
    - 新增5种爆款标题公式库（数字具体化、对立冲突、身份认同、悬念反转、情绪宣泄）。
    - 新增标题自检清单（3秒法则、具体化检查）。
  - **写作执行**（`writing-executor`）：
    - 新增"开头钩子"强制模块（4种钩子类型：场景代入、身份捆绑、悬念打开、情绪共振）。
    - 强制"前50字生死线"检查。
  - **共情点设计师**（`empathy-designer`）：
    - 强化开头50字的共情设计权重。

- 🎨 **风格与资源升级**：
  - **风格文件增强**：
    - `墨水怪风.md` 和 `jiubian.md` 新增"目标读者画像"维度（第16节）。
    - 包含精准画像、阅读场景、核心需求、禁忌雷区。
  - **案例库框架**：
    - 创建 `articles/_case_library/` 目录结构。
    - 提供三大类案例模板：职场故事、认知反转、情绪共鸣。

### Changed
- 🔄 **写作工作流优化**：
  - 新增"Stage 0: 选题调研"（动笔前先验证）。
  - 新增"Stage 8: 发布前把关"（发布前先评审）。
  - 标题设计和开头设计权重大幅提升。



### Added
- ✨ **协作写作工作流系统**：
  - 新增 `workflow-producer`（工作流导演）作为所有写作请求的唯一入口
  - 强制模式选择：轻量模式 vs 协作模式（8阶段）
  - 8阶段完整 SOP：主题校准 → 调研 → 大纲 → 共情 → 具象化 → 标题设计 → 创作 → 审稿
  - 每阶段完成后显示进度条和产物保存路径
  
- ✨ **标题设计师 Skill**（`title-designer`）：
  - 独立的标题设计环节（Stage 5.5）
  - 设计3种候选标题：吸引型/信息型/情绪型
  - 禁止 AI 套路标题（如"深度解读XXX"）
  - 用户确认后才能进入正式写作
  
- ✨ **风格建模系统升级至 v3.0**：
  - **12维度 → 15维度深度解构框架**
  - 新增维度：
    - 作者画像与核心人格（基础特征、知识结构、经历痕迹）
    - 思维内核与论证逻辑（核心世界观、价值判断、分析模式）
    - 创作路径还原（痛点捕捉、共情设计、出路探索）
    - 互动设计（读者预设、互动技巧、引导策略）
  - 扩展维度：
    - 词汇指纹（5类细分：口语连接词、高频动词、程度副词、情感词汇、网络流行语）
    - 招牌动作（5类细分：悖论翻转、质疑打断、情绪短句、自问自答、务实建议）
    
- ✨ **新增风格配方**：
  - **九边风**（`jiubian.md`）：职场老炮式人生导师
    - 招牌动作："那问题来了"、案例故事化、承认局限
    - 分析模式：现象→机制→人性→出路
  - **墨水怪风**（`墨水怪风.md`）更新：基于新样本重新解构
    - 招牌动作：悖论翻转、质疑打断、真诚骂人
    - 特色词汇：兽性、进化心理学、巴甫洛夫
    
- 📚 **新增协作 Skills**：
  - `outline-architect`（大纲架构师）
  - `empathy-designer`（共情点设计师）
  - `concretizer`（具象化专家）
  
- 📖 **新增文档**：
  - `docs/WORKFLOW_QUICK_REFERENCE.md`（协作写作工作流快速参考）
  - `docs/SKILLS_UPDATE_SUMMARY.md`（Skills 更新总结）
  - `docs/jiubiancank.md`（九边风格分析参考）
  - `docs/墨水怪.md`（墨水怪风格样本）

### Changed
- 🔧 **子 Skill 权限调整**：
  - 将 `writing-clarifier`、`writing-executor` 等标记为 `INTERNAL UTILITY ONLY`
  - 防止跳过工作流导演直接调用
  - 所有写作请求必须经过 `workflow-producer` 统一调度
  
- 🔧 **标题设计流程优化**：
  - 从 `writing-executor` 的第5步提升至第2.5步
  - 在信息汇总确认后立即设计标题
  - 用户确认标题后才能进入字数规划和正式写作
  
- 🔧 **风格检查防幻觉**：
  - 强制使用 `list_dir` 工具检查 `.claude/styles/` 目录
  - 禁止 AI 编造不存在的风格名称
  - 只能列出工具返回的真实文件名

### Fixed
- 🐛 修复风格建模可能跳过标题设计的问题
- 🐛 修复 AI 可能编造不存在风格的问题
- 🐛 修复协作模式下可能跳过某些阶段的问题

---

## [0.1.0] - 2025-12-21

### Added
- 🎉 **首次公开发布**
- **5个核心 Skills**：
  - `writing-clarifier`（写作需求澄清 v1.3.0）
  - `research-expert`（调研资料 v1.0.0）
  - `style-modeler`（风格建模 v2.0.0）
  - `writing-executor`（写作执行 v1.6.0）
  - `editor-review`（主编审稿 v1.1.0）
- **反AI味道系统**：
  - 自动去除小标题病、排比上瘾、格式洁癖等AI典型特征
  - 默认启用反AI格式，无需每次确认
- **风格建模系统**：
  - 12维度深度解构
  - 招牌动作提取
  - 段落模板库
  - 示例风格：墨水怪风（173行完整配方）
- **字数精准控制**：
  - 强制外部工具统计（误差±20%以内）
  - 关键节点检查机制（开头/主体50%/主体80%）
  - 黄线/红线/死线机制
- **版本管理**：
  - 自动保存初稿、修订稿、最终稿
  - 文件命名规则：`[标题]_[版本号]稿.md`
- **标题设计模块**：
  - 3个候选标题（吸引型/信息型/情绪型）
- **信息交接模块**：
  - 写作前显式输出信息汇总表
- **工作流完整性**：
  - 强制询问是否需要调研
  - 防止跳过关键步骤
- **DeepSeek API 支持**：
  - 完美兼容 Anthropic API
  - 成本极低（一篇2000字文章约¥0.03）
  - 详细配置文档

### Documentation
- 完整的 README.md（中文）
- CHANGELOG.md（版本历史）
- CONTRIBUTING.md（贡献指南）
- LICENSE（MIT）
- docs/FAQ.md（24个常见问题）
- docs/DEEPSEEK_SETUP.md（DeepSeek配置指南）
- docs/PROJECT_STRUCTURE.md（项目结构说明）

---

## 版本号说明

- **Major (X.0.0)**: 重大架构变更或不兼容更新
- **Minor (0.X.0)**: 新功能添加
- **Patch (0.0.X)**: Bug 修复和小优化
