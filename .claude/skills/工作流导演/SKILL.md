---
name: workflow-producer
description: [MASTER ENTRY POINT] The ONLY skill to handle ALL writing requests. Whether the user says "write an article", "clarify requirements", "outline", "research", or "draft", you MUST invoke this skill first. It manages the mandatory workflow: Mode Selection -> Clarification -> Research -> Outline -> Empathy -> Concrete -> Draft -> Review. NEVER skip this skill.
---

# 工作流导演 (Workflow Producer)

## 指令 (Instructions)

**⚠️ 强制规则：收到任何写作请求后，第一步必须询问用户选择模式。不允许自动判断。**

### Step 0: 强制询问模式（必须执行，不可跳过）

**当用户提出任何与写作相关的请求时，你必须先输出以下内容：**

```
🎬 请选择工作流模式：

【A. 轻量模式】快速产出
   适用场景：短文（≤1000字）、随笔、个人观点、已有完整素材
   流程：需求澄清 → 写作 → 简单审稿

【B. 协作模式】深度创作 ⭐ 推荐
   适用场景：长文（>1500字）、深度分析、需要数据/案例支撑
   流程：7阶段完整SOP，包含调研、大纲、共情设计、多版审稿

请输入 A 或 B 选择模式：
```

**只有在用户明确回复 A 或 B 后，才能进入下一步。**

---

### 1. 模式详情

**用户选择后，根据选择执行对应流程：**

#### 轻量模式（快速产出）
**触发条件（满足任一即可）：**
- 用户明确说"快速写一篇"、"简单写写"、"不需要太复杂"
- 字数要求 ≤ 1000 字
- 个人观点文、随笔、日常分享类
- 用户已有完整素材，只需要"组织成文"

**流程：**
```
需求澄清 → 写作执行 → 简单审稿 → 完成
```

**调用顺序：**
1. `writing-clarifier`（澄清需求）
2. `writing-executor`（直接写作）
3. `editor-review`（轻度审稿，可选）

---

#### 协作模式（深度创作）⭐
**触发条件（满足任一即可）：**
- 用户明确要求"深度分析"、"长文"、"带案例"、"带调研"、"多版本迭代"
- 字数要求 > 1500 字
- 需要数据支撑、案例论证的文章
- 观点复杂、需要逻辑推演的文章
- 用户说"我想写得专业一点"、"需要有说服力"

**流程（8 阶段）：**
```
阶段清单：
□ Stage 1: 主题与读者校准
□ Stage 2: 案例与证据池
□ Stage 3: 逻辑骨架搭建
□ Stage 4: 共情点设计
□ Stage 5: 具象化翻译（按需）
□ Stage 5.5: 标题设计 ⭐ 必须
□ Stage 6: 正式创作
□ Stage 7: 主编审稿与改稿
```

---

### 2. 协作模式详细流程

#### Stage 1: 主题与读者校准
**目标：** 明确核心问题、核心观点、目标读者、文章定位

**调用：** `writing-clarifier`

**产物：** `articles/[项目名]/01_theme.md`

**内容包含：**
- 核心问题（1-2 句）
- 核心观点（3-5 条）
- 目标读者画像（1 段）
- 文章定位（不是道德评判，而是帮助理解/行动）
- 风格选择（如有）
- 目标字数

**完成标准（DoD）：**
- ✅ 观点不自相矛盾
- ✅ 读者与定位明确
- ✅ 用户确认无误

**下一步提示：**
```
✅ Stage 1 完成：主题与读者已校准

📋 当前进度：[█░░░░░░] 14% (1/7)

📁 已保存：articles/[项目名]/01_theme.md

下一步选项：
A. 【调研素材】搜集数据、案例、观点（推荐：需要事实支撑）
B. 【跳过调研】直接进入大纲搭建（推荐：个人观点文）

请选择 A 或 B：
```

---

#### Stage 2: 案例与证据池
**目标：** 搜集硬核数据、典型案例、生活化故事

**调用：** `research-expert`

**产物：** `articles/[项目名]/02_cases.md`

**内容包含：**
- 硬核数据（带来源）
- 典型案例（行业/学术）
- 生活化案例（人物-冲突-转折-结果-落点）
- 可引用观点

**完成标准（DoD）：**
- ✅ 至少 3 个"可讲故事"的案例骨架
- ✅ 案例具体，有细节抓手，不是抽象"有人如何如何"
- ✅ 数据有来源标注

**下一步提示：**
```
✅ Stage 2 完成：案例与证据池已建立

📋 当前进度：[██░░░░░] 28% (2/7)

📁 已保存：articles/[项目名]/02_cases.md

下一步：
→ 进入 Stage 3：逻辑骨架搭建

继续请回复"继续"或"下一步"
```

---

#### Stage 3: 逻辑骨架搭建
**目标：** 设计文章结构，标注每段功能

**调用：** `outline-architect`

**产物：** `articles/[项目名]/03_outline.md`

**内容包含：**
- 大纲（现象→原因→本质→出路 或其他模板）
- 每段功能标注（引入/论证/举例/反驳/转折/收尾）
- 段落字数预估

**完成标准（DoD）：**
- ✅ 避免重复论证
- ✅ 每段有独立价值
- ✅ 逻辑链完整

**下一步提示：**
```
✅ Stage 3 完成：逻辑骨架已搭建

📋 当前进度：[███░░░░] 42% (3/7)

📁 已保存：articles/[项目名]/03_outline.md

下一步选项：
A. 【设计共情点】标注读者心理路径（推荐：观点文/故事文）
B. 【跳过共情设计】直接进入写作（推荐：纯干货文）

请选择 A 或 B：
```

---

#### Stage 4: 共情点设计（可选）
**目标：** 预测读者心理，标注共鸣点/破防点/疑问点

**调用：** `empathy-designer`

**产物：** `articles/[项目名]/04_empathy_map.md`

**内容包含：**
- 共鸣点清单（读者会点头的地方）
- 破防点清单（读者会被戳中的地方）
- 疑问点清单（读者会产生疑问的地方，需要提前解答）

**完成标准（DoD）：**
- ✅ 不是煽情，而是"读者心理过程可被预测"
- ✅ 每个共情点都有对应的段落

**下一步提示：**
```
✅ Stage 4 完成：共情点已设计

📋 当前进度：[████░░░] 57% (4/7)

📁 已保存：articles/[项目名]/04_empathy_map.md

下一步：
→ 进入 Stage 6：正式创作（Stage 5 具象化翻译按需触发）

继续请回复"继续"或"下一步"
```

---

#### Stage 5: 具象化翻译（按需触发）
**触发时机：** 写作过程中遇到抽象概念时

**调用：** `concretizer`

**产物：** `articles/[项目名]/05_concrete_library.md`

**说明：** 此阶段不在主流程中，而是在写作时按需调用

---

#### Stage 5.5: 标题设计（必须执行！不可跳过！）⭐
**目标：** 在正式写作前，为文章设计标题

**调用：** `title-designer`

**产物：** 确定的文章标题（用于文件命名和正文顶部）

**流程：**
1. 设计3个候选标题（吸引型/信息型/情绪型）
2. 让用户选择
3. 确认后才能进入 Stage 6

**完成标准（DoD）：**
- ✅ 用户已从3个候选中选择1个
- ✅ 标题符合风格要求
- ✅ 标题长度适中（15-25字）

**下一步提示：**
```
✅ Stage 5.5 完成：标题已确定

📋 当前进度：[█████░░] 62% (5.5/8)

📌 确定标题：「[用户选择的标题]」

下一步：
→ 进入 Stage 6：正式创作

继续请回复"继续"或"下一步"
```

---

#### Stage 6: 正式创作
**目标：** 基于以上所有准备，写出初稿 v1

**调用：** `writing-executor`

**产物：** `articles/[项目名]/draft_v1.md`

**内容包含：**
- 完整正文
- 元数据（版本、字数、风格、创建时间）
- 段落功能标注（可选）

**完成标准（DoD）：**
- ✅ 结构完整
- ✅ 口吻一致
- ✅ 案例落地
- ✅ 结尾有力量
- ✅ 字数误差 ±20% 以内

**下一步提示：**
```
✅ Stage 6 完成：初稿 v1 已完成

📋 当前进度：[█████░░] 71% (5/7)

📁 已保存：articles/[项目名]/draft_v1.md（共 XXXX 字）

下一步：
→ 进入 Stage 7：主编审稿

继续请回复"继续"或"审稿"
```

---

#### Stage 7: 主编审稿与改稿
**目标：** 诊断问题，生成修改清单，输出 v2

**调用：** 
1. `editor-review`（审稿）
2. `writing-executor`（改稿）

**产物：** 
- `articles/[项目名]/draft_v2.md`（修订稿）
- `articles/[项目名]/changelog.md`（变更记录）

**内容包含：**
- 修改摘要（bullet）
- 删除/合并点说明
- 风格校准说明（温度、攻击性、学术度）

**完成标准（DoD）：**
- ✅ 更顺、更有共鸣、更不重复
- ✅ 保留作者特色
- ✅ AI 味道显著降低

**完成提示：**
```
✅ Stage 7 完成：主编审稿与改稿已完成

📋 当前进度：[███████] 100% (7/7)

📁 已保存：
  - articles/[项目名]/draft_v2.md（共 XXXX 字）
  - articles/[项目名]/changelog.md

🎉 协作工作流完成！

下一步选项：
A. 【继续迭代】进入 v3 修订
B. 【确认定稿】保存为最终稿
C. 【导出全部】导出所有产物

请选择 A/B/C：
```

---

### 3. 产物管理

**目录结构：**
```
articles/
└── [项目名]/
    ├── 01_theme.md          # 主题与读者
    ├── 02_cases.md          # 案例库（如有调研）
    ├── 03_outline.md        # 大纲
    ├── 04_empathy_map.md    # 共情点（如有）
    ├── 05_concrete_library.md # 具象化库（如有）
    ├── draft_v1.md          # 初稿
    ├── draft_v2.md          # 修订稿
    ├── draft_v3.md          # 再修订（如有）
    ├── draft_最终稿.md      # 最终版本
    ├── changelog.md         # 变更记录
    └── sources.md           # 引用来源（如有）
```

**文件命名规则：**
- 项目名 = 文章标题（去掉特殊字符）
- 版本号：v1, v2, v3...
- 最终稿：`draft_最终稿.md`

---

### 4. 版本管理

**changelog.md 格式：**
```markdown
# 变更记录

## v2 → v1 (2025-12-28 10:30)
**修改类型：** 主编审稿后修订

**主要变更：**
- 删除第 3 段重复论证（原 180 字）
- 合并第 5-6 段，避免逻辑跳跃（现 220 字）
- 调整第 8 段语气，降低攻击性（"他妈的" → "说实话"）
- 补充第 4 段案例细节（新增人物对话）

**字数变化：** 2100 字 → 1950 字

**风格校准：**
- 温度：7/10 → 6/10（略微降温）
- 攻击性：8/10 → 6/10（减少脏话）
- 学术度：3/10（保持不变）

---

## v1 (2025-12-28 09:45)
**初稿完成**
```

---

### 5. 引用管理（可选）

**触发条件：**
- 文章中出现"心理学研究"、"实验"、"数据"、"比例"等内容
- 用户开启 `require_citations=true`

**sources.md 格式：**
```markdown
# 引用来源

## 数据来源
1. [数据1] - 来源：XXX 报告，2024 年
2. [数据2] - 来源：XXX 研究，2023 年

## 案例来源
1. [案例1] - 来源：XXX 媒体报道，2024-06-15
2. [案例2] - 来源：XXX 书籍，第 X 章

## 观点来源
1. [观点1] - 来源：XXX 专家访谈，2024 年

## 未经验证的说法
- [说法1]：推测性内容，无可靠来源
```

---

### 6. 中途恢复与跳过

**恢复流程：**
如果用户中途离开，下次可以从任意阶段恢复：
```
检测到未完成的项目：[项目名]

当前进度：[███░░░░] 42% (3/7)

已完成阶段：
✅ Stage 1: 主题与读者校准
✅ Stage 2: 案例与证据池
✅ Stage 3: 逻辑骨架搭建

下一步：
→ Stage 4: 共情点设计

是否继续？(是/否)
```

**跳过阶段：**
用户可以跳过某些阶段：
```
用户：跳过共情设计，直接写作

AI：
好的，跳过 Stage 4，直接进入 Stage 6：正式创作

📋 当前进度：[█████░░] 71% (5/7)
（已跳过：Stage 4 共情点设计）

开始写作...
```

---

### 7. 导出功能

**导出选项：**
```
A. 【仅导出最终稿】draft_最终稿.md
B. 【导出全部产物】打包整个项目文件夹
C. 【导出对比版本】v1 vs v2 对比文档
```

---

## 示例 (Examples)

**用户：** 我想写一篇关于"35 岁程序员危机"的深度分析文章，3000 字左右。

**AI：**
```
🎬 工作流模式：协作模式（深度创作）

📋 阶段清单：
□ Stage 1: 主题与读者校准
□ Stage 2: 案例与证据池
□ Stage 3: 逻辑骨架搭建
□ Stage 4: 共情点设计
□ Stage 5: 具象化翻译（按需）
□ Stage 6: 正式创作
□ Stage 7: 主编审稿与改稿

📁 项目名称：35岁程序员危机

现在开始 Stage 1：主题与读者校准
→ 调用 writing-clarifier...
```

---

## 最佳实践 (Best Practices)

- **强制询问模式：** 收到写作请求后，第一步必须询问用户选择轻量模式还是协作模式，不允许自动判断
- **进度可视化：** 每阶段完成后显示进度条和 checkbox
- **产物必须落盘：** 每阶段完成后立即保存文件，不依赖对话上下文
- **允许跳过：** 用户可以跳过某些阶段（如共情设计），但必须记录
- **支持恢复：** 用户可以从任意阶段恢复，基于已保存的文件
- **版本追踪：** 每次修改必须记录到 changelog.md
- **引用透明：** 如果有数据/案例，必须标注来源或标注"未经验证"

## 版本记录 (Version History)
- v1.0.0 (2025-12-28): 初始版本，实现协作写作工作流的流程编排与产物管理。
